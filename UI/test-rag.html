<!DOCTYPE html>
<html>
<head>
    <title>RAG Test</title>
    <script>
        function testRag() {
            const query = document.getElementById('query').value;
            document.getElementById('status').textContent = 'Sending request...';

            fetch('http://127.0.0.1:3000/api/rag_chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ query: query })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('status').textContent = 'Response received';
                document.getElementById('response').textContent = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                document.getElementById('status').textContent = 'Error: ' + error.message;
                console.error('Error:', error);
            });
        }
    </script>
    <style>
        /* RAG Status Indicator */
        .rag-status {
            position: fixed;
            bottom: 15px;
            right: 15px;
            z-index: 1000;
            background-color: rgba(40, 40, 40, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .rag-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #76b900; /* NVIDIA green */
        }

        .rag-status-text {
            font-family: Arial, sans-serif;
        }

        /* Logo container moved to bottom right */
        .nvidia-logo-container {
            position: fixed;
            bottom: 45px; /* Changed from top to bottom, adjusted to be above RAG status */
            right: 10px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            opacity: 0.8;
            transform: scale(0.7);
            transform-origin: bottom right; /* Changed to bottom right */
        }

        /* Smaller logo styling */
        .nvidia-logo {
            width: 60px;
            height: auto;
        }

        /* Copyright text */
        .copyright-text {
            font-size: 8px;
            color: #ccc;
            margin-top: 2px;
            font-family: Arial, sans-serif;
        }

        /* Make the logo hover interactive */
        .nvidia-logo-container:hover {
            opacity: 1;
        }

        /* Ensure the logo doesn't block clickable elements */
        @media (max-width: 768px) {
            .nvidia-logo-container {
                transform: scale(0.6); /* Even smaller on mobile */
            }
        }
    </style>
</head>
<body>
    <h1>RAG API Test</h1>
    <div>
        <input type="text" id="query" value="What is Jetson Orin?" style="width: 300px;">
        <button onclick="testRag()">Test RAG</button>
    </div>
    <div id="status" style="margin-top: 10px; font-weight: bold;"></div>
    <pre id="response" style="margin-top: 10px; background: #f0f0f0; padding: 10px;"></pre>

    <!-- RAG Status Indicator -->
    <div class="rag-status">
        <div class="rag-status-dot"></div>
        <div class="rag-status-text">RAG Enabled</div>
    </div>

    <!-- NVIDIA Logo and Copyright -->
    <div class="nvidia-logo-container">
        <img src="NVLogo_2D.jpg" alt="NVIDIA Logo" class="nvidia-logo" onerror="this.style.display='none'">
        <span class="copyright-text">Â© NVIDIA 2025</span>
    </div>

    <script>
        // Check RAG status on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if RAG is ready
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    const ragStatus = document.querySelector('.rag-status');
                    const ragDot = document.querySelector('.rag-status-dot');
                    const ragText = document.querySelector('.rag-status-text');

                    if (data.embeddings_ready) {
                        ragDot.style.backgroundColor = '#76b900'; // NVIDIA green
                        ragText.textContent = 'Documents Loaded';
                    } else {
                        ragDot.style.backgroundColor = '#f59e0b'; // amber
                        ragText.textContent = 'Loading Documents...';

                        // Check again in 10 seconds
                        setTimeout(checkRagStatus, 10000);
                    }
                })
                .catch(error => {
                    console.error('Error checking RAG status:', error);
                    const ragDot = document.querySelector('.rag-status-dot');
                    const ragText = document.querySelector('.rag-status-text');
                    ragDot.style.backgroundColor = '#ef4444'; // red
                    ragText.textContent = 'RAG Error';
                });
        });

        function checkRagStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    const ragDot = document.querySelector('.rag-status-dot');
                    const ragText = document.querySelector('.rag-status-text');

                    if (data.embeddings_ready) {
                        ragDot.style.backgroundColor = '#76b900'; // NVIDIA green
                        ragText.textContent = 'Documents Loaded';
                    } else {
                        // Check again in 10 seconds
                        setTimeout(checkRagStatus, 10000);
                    }
                })
                .catch(error => {
                    console.error('Error checking RAG status:', error);
                });
        }
    </script>
</body>
</html>